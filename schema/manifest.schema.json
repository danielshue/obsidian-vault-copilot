{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Vault Copilot Extension Manifest",
  "description": "Schema for Vault Copilot extension manifest files. Defines the structure and validation rules for extension metadata, files, and configuration.",
  "type": "object",
  "required": ["id", "name", "version", "type", "description", "author", "files"],
  "additionalProperties": false,
  "properties": {
    "$schema": {
      "type": "string",
      "description": "Reference to the JSON Schema for validation. Should point to manifest.schema.json."
    },
    "id": {
      "type": "string",
      "pattern": "^[a-z0-9-]+$",
      "description": "Unique identifier for the extension. Must contain only lowercase letters, numbers, and hyphens. Used as the canonical reference for dependencies and installations.",
      "examples": ["daily-notes-agent", "research-assistant", "voice-journal"]
    },
    "name": {
      "type": "string",
      "maxLength": 50,
      "description": "Human-readable display name for the extension. Shown in the catalog and installation UI.",
      "examples": ["Daily Notes Agent", "Research Assistant", "Voice Journal"]
    },
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "description": "Semantic version number in the format MAJOR.MINOR.PATCH (e.g., 1.0.0). Follow semver conventions for versioning.",
      "examples": ["1.0.0", "2.1.3", "0.5.0"]
    },
    "type": {
      "type": "string",
      "enum": ["agent", "voice-agent", "prompt", "skill", "mcp-server", "automation"],
      "description": "The type of extension. Determines installation location and behavior: 'agent' for AI agents, 'voice-agent' for voice-enabled agents, 'prompt' for reusable prompts, 'skill' for Copilot skills, 'mcp-server' for Model Context Protocol server integrations, 'automation' for scheduled or event-triggered workflows."
    },
    "description": {
      "type": "string",
      "maxLength": 500,
      "description": "Brief description of what the extension does. Displayed in catalog listings and search results. Keep it concise and informative.",
      "examples": ["Automatically creates and manages daily notes with AI-powered summaries", "Voice-activated journaling with emotion tracking and insights"]
    },
    "author": {
      "type": "object",
      "description": "Information about the extension author or maintainer.",
      "required": ["name"],
      "additionalProperties": false,
      "properties": {
        "name": {
          "type": "string",
          "description": "The author's display name or organization name.",
          "examples": ["Jane Developer", "Vault Community", "Acme Corp"]
        },
        "url": {
          "type": "string",
          "format": "uri",
          "description": "URL to the author's website, GitHub profile, or other online presence.",
          "examples": ["https://github.com/janedeveloper", "https://example.com"]
        },
        "email": {
          "type": "string",
          "format": "email",
          "description": "Contact email address for the author.",
          "examples": ["jane@example.com", "support@acmecorp.com"]
        }
      }
    },
    "files": {
      "type": "array",
      "minItems": 1,
      "description": "List of files to install. Each entry specifies a source file and its target installation path within the vault.",
      "items": {
        "type": "object",
        "required": ["source", "installPath"],
        "additionalProperties": false,
        "properties": {
          "source": {
            "type": "string",
            "description": "The filename of the source file in the extension's folder. Must be a valid filename without path separators.",
            "examples": ["my-agent.agent.md", "config.json", "prompt.md"]
          },
          "installPath": {
            "type": "string",
            "description": "The target folder path within the vault where the file will be installed. Use forward slashes and end with a trailing slash for directories.",
            "examples": ["Reference/Agents/", "Reference/Prompts/", ".obsidian/"]
          }
        }
      }
    },
    "repository": {
      "type": "string",
      "format": "uri",
      "description": "URL to the extension's source code repository (e.g., GitHub, GitLab).",
      "examples": ["https://github.com/username/my-extension", "https://gitlab.com/org/extension"]
    },
    "license": {
      "type": "string",
      "default": "MIT",
      "description": "The license under which the extension is distributed. Use SPDX license identifiers when possible.",
      "examples": ["MIT", "Apache-2.0", "GPL-3.0", "BSD-3-Clause"]
    },
    "minVaultCopilotVersion": {
      "type": "string",
      "description": "Minimum required version of Vault Copilot for this extension to work. Follows semver format.",
      "examples": ["0.1.0", "1.0.0", "2.0.0"]
    },
    "categories": {
      "type": "array",
      "description": "Categories that best describe the extension's functionality. Used for catalog organization and filtering.",
      "items": {
        "type": "string",
        "enum": [
          "Productivity",
          "Journaling",
          "Research",
          "Writing",
          "Task Management",
          "Voice",
          "Integration",
          "MCP",
          "Utility"
        ]
      },
      "uniqueItems": true,
      "examples": [["Productivity", "Writing"], ["Voice", "Journaling"], ["MCP", "Integration"]]
    },
    "tags": {
      "type": "array",
      "description": "Free-form tags for enhanced discoverability and search. Use descriptive, lowercase keywords.",
      "items": {
        "type": "string"
      },
      "uniqueItems": true,
      "examples": [["automation", "daily-notes", "templates"], ["voice", "transcription", "speech"]]
    },
    "tools": {
      "type": "array",
      "description": "List of Vault Copilot tools that this extension uses or requires. Helps users understand the extension's capabilities.",
      "items": {
        "type": "string"
      },
      "uniqueItems": true,
      "examples": [["create_note", "read_note", "search_vault"], ["fetch_webpage", "summarize"]]
    },
    "dependencies": {
      "type": "array",
      "description": "IDs of other extensions that must be installed for this extension to work properly. Dependencies are checked during installation.",
      "items": {
        "type": "string",
        "pattern": "^[a-z0-9-]+$"
      },
      "uniqueItems": true,
      "examples": [["base-templates", "utility-functions"], ["voice-core"]]
    },
    "permissions": {
      "type": "array",
      "description": "Special permissions required by this extension. Users will be informed of these during installation.",
      "items": {
        "type": "string"
      },
      "uniqueItems": true,
      "examples": [["network-access", "file-system"], ["microphone", "notifications"]]
    },
    "preview": {
      "type": "string",
      "description": "Filename of a preview image to display in the catalog. Should be a PNG or JPG file included in the extension folder.",
      "examples": ["preview.png", "screenshot.jpg", "demo.gif"]
    },
    "changelog": {
      "type": "string",
      "description": "Filename of the changelog file documenting version history and changes.",
      "examples": ["CHANGELOG.md", "changelog.txt", "HISTORY.md"]
    },
    "versions": {
      "type": "array",
      "description": "Version history with release notes for each version. Newest versions should appear first.",
      "items": {
        "type": "object",
        "required": ["version", "date"],
        "additionalProperties": false,
        "properties": {
          "version": {
            "type": "string",
            "pattern": "^\\d+\\.\\d+\\.\\d+$",
            "description": "The version number.",
            "examples": ["1.0.0", "1.1.0", "2.0.0"]
          },
          "date": {
            "type": "string",
            "format": "date",
            "description": "Release date in ISO 8601 format (YYYY-MM-DD).",
            "examples": ["2026-02-01", "2026-01-15"]
          },
          "changes": {
            "type": "array",
            "description": "List of changes in this version.",
            "items": {
              "type": "string"
            },
            "examples": [["Added goal tracking feature", "Fixed date parsing bug", "Improved performance"]]
          }
        }
      }
    },
    "featured": {
      "type": "boolean",
      "default": false,
      "description": "Whether this extension should be featured prominently in the catalog. Typically set by catalog maintainers."
    },
    "publishedAt": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 date-time when the extension was first published. Automatically set by the publishing system.",
      "examples": ["2026-01-15T10:30:00Z", "2025-12-01T00:00:00Z"]
    },
    "submittedBy": {
      "type": "string",
      "description": "GitHub username of the person who submitted or last updated this extension. Used for update validation to ensure only the original submitter can update the extension.",
      "examples": ["danielshue", "janedeveloper", "github-username"]
    },
    "automation": {
      "type": "object",
      "description": "Automation-specific configuration. Required when type is 'automation'. Defines triggers and actions for scheduled or event-based workflows.",
      "properties": {
        "triggers": {
          "type": "array",
          "description": "List of triggers that activate this automation.",
          "minItems": 1,
          "items": {
            "type": "object",
            "required": ["type"],
            "properties": {
              "type": {
                "type": "string",
                "enum": ["schedule", "file-created", "file-modified", "file-deleted", "vault-opened", "tag-added", "startup"],
                "description": "Type of trigger: 'schedule' for time-based (cron), 'file-created'/'file-modified'/'file-deleted' for file events, 'vault-opened' when vault opens, 'tag-added' when a tag is added to a note, 'startup' when plugin loads."
              },
              "schedule": {
                "type": "string",
                "description": "Cron expression for schedule triggers (e.g., '0 9 * * *' for daily at 9am). Uses standard cron syntax.",
                "examples": ["0 9 * * *", "0 */2 * * *", "0 0 * * 1"]
              },
              "pattern": {
                "type": "string",
                "description": "File path pattern for file-based triggers. Supports wildcards (* and **).",
                "examples": ["Daily Notes/*.md", "Projects/**/*.md", "*.md"]
              },
              "tag": {
                "type": "string",
                "description": "Tag name for tag-added triggers.",
                "examples": ["#todo", "#review", "#automated"]
              },
              "delay": {
                "type": "number",
                "description": "Delay in milliseconds before executing actions after trigger fires.",
                "minimum": 0,
                "examples": [0, 1000, 5000]
              }
            }
          }
        },
        "actions": {
          "type": "array",
          "description": "List of actions to execute when triggered.",
          "minItems": 1,
          "items": {
            "type": "object",
            "required": ["type"],
            "properties": {
              "type": {
                "type": "string",
                "enum": ["run-agent", "run-prompt", "run-skill", "create-note", "update-note", "run-command"],
                "description": "Type of action to execute."
              },
              "agentId": {
                "type": "string",
                "description": "ID of agent to run (for run-agent action)."
              },
              "promptId": {
                "type": "string",
                "description": "ID of prompt to run (for run-prompt action)."
              },
              "skillId": {
                "type": "string",
                "description": "ID of skill to run (for run-skill action)."
              },
              "template": {
                "type": "string",
                "description": "Template content or path for note creation."
              },
              "path": {
                "type": "string",
                "description": "Target path for note operations."
              },
              "commandId": {
                "type": "string",
                "description": "Obsidian command ID to execute (for run-command action)."
              },
              "input": {
                "type": "object",
                "description": "Input parameters to pass to the action.",
                "additionalProperties": true
              }
            }
          }
        },
        "enabled": {
          "type": "boolean",
          "default": false,
          "description": "Whether the automation is enabled by default after installation."
        },
        "runOnInstall": {
          "type": "boolean",
          "default": false,
          "description": "Whether to run the automation immediately upon installation."
        }
      },
      "required": ["triggers", "actions"]
    }
  }
}
