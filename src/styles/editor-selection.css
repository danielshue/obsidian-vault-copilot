/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Dan Shue. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

/**
 * Editor Selection Preservation
 * 
 * Preserves visual highlighting of text selections in the Obsidian editor
 * even when focus moves to other elements (e.g., chat input).
 * 
 * This improves UX by:
 * - Showing users what text will be included as context
 * - Making implicit context augmentation more transparent
 * - Maintaining visual feedback across focus changes
 */

/* 
 * Preserve selection highlighting in unfocused/inactive editor elements
 * Uses ::selection pseudo-element to style text selection appearance
 * Works across all editor elements in the workspace
 * 
 * IMPORTANT: Use fallback color in case --text-selection is not defined
 */
.workspace-leaf-content ::selection {
	background: var(--text-selection, rgba(0, 122, 255, 0.2));
	color: inherit;
}

/* 
 * CodeMirror 6 selection preservation
 * Obsidian uses CodeMirror 6 for the editor
 * CodeMirror 6 renders selections using a .cm-selectionLayer with .cm-selectionBackground divs
 */
.cm-editor .cm-content ::selection,
.cm-editor .cm-line ::selection {
	background: var(--text-selection, rgba(0, 122, 255, 0.2));
}

/*
 * Ensure selection background remains visible in all editor states
 * CodeMirror 6 uses .cm-selectionLayer as a container for selection backgrounds
 * Apply base color for both focused and unfocused states
 * Use !important to override CodeMirror's inline styles
 */
.cm-editor .cm-selectionLayer .cm-selectionBackground {
	background-color: var(--text-selection, rgba(0, 122, 255, 0.2)) !important;
}

/*
 * Keep selection layer visible when editor loses focus
 * IMPORTANT: By default, CodeMirror 6 hides the selection layer when not focused
 * We override this to maintain visual feedback for context augmentation
 */
.cm-editor:not(.cm-focused) .cm-selectionLayer {
	display: block !important;
	visibility: visible !important;
}

/*
 * Reduce opacity when editor loses focus to indicate inactive state
 */
.cm-editor:not(.cm-focused) .cm-selectionLayer .cm-selectionBackground {
	opacity: 0.7 !important; /* Slightly more transparent to indicate inactive state */
}

/*
 * Mobile-specific adjustments
 * Ensure selection remains visible on mobile devices
 */
.is-mobile .cm-editor:not(.cm-focused) .cm-selectionLayer .cm-selectionBackground {
	opacity: 0.6 !important; /* More transparent on mobile for clearer visual distinction */
}

/*
 * Preserve selection in Legacy editor (for older Obsidian versions)
 * Uses contenteditable-based editor
 */
.markdown-source-view.is-readable-line-width ::selection,
.markdown-source-view ::selection {
	background: var(--text-selection, rgba(0, 122, 255, 0.2));
}
