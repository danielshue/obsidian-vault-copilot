<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  
  <title>{% if page.title %}{{ page.title }} | {% endif %}{{ site.title }}</title>
  
  <!-- SEO -->
  {% seo %}
  
  <!-- Stylesheets -->
  <link rel="stylesheet" href="{{ '/assets/css/extensions.css' | relative_url }}">
  
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="{{ '/assets/images/favicon.png' | relative_url }}">
</head>
<body>
  {% include header.html %}
  
  <main class="main-content">
    <!-- Backdrop overlay for mobile sidebar -->
    <div class="sidebar-backdrop"></div>
    
    <!-- Sidebar Toggle Button -->
    <button class="sidebar-toggle" aria-label="Toggle sidebar" aria-expanded="false">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="3" y1="12" x2="21" y2="12"></line>
        <line x1="3" y1="6" x2="21" y2="6"></line>
        <line x1="3" y1="18" x2="21" y2="18"></line>
      </svg>
    </button>
    
    <div class="extension-container">
      <!-- Main Content Column -->
      <article class="extension-content">
        <header class="extension-header">
          {% if page.icon %}
          <img src="{{ page.icon | relative_url }}" alt="{{ page.title }} icon" class="extension-icon">
          {% endif %}
          <div class="extension-title-group">
            <h1>{{ page.title }}</h1>
            {% if page.description %}
            <p class="extension-description-text">{{ page.description }}</p>
            {% endif %}
          </div>
        </header>
        
        <div class="extension-description">
          {{ content }}
        </div>
        
        <!-- Changelog Section -->
        {% if page.versions and page.versions.size > 0 %}
        <section class="extension-changelog">
          <h2>Version History</h2>
          <div class="changelog-list">
            {% for version in page.versions %}
            <div class="changelog-entry">
              <div class="changelog-header">
                <span class="changelog-version">v{{ version.version }}</span>
                <span class="changelog-date">{{ version.date }}</span>
              </div>
              {% if version.changes and version.changes.size > 0 %}
              <ul class="changelog-changes">
                {% for change in version.changes %}
                <li>{{ change }}</li>
                {% endfor %}
              </ul>
              {% endif %}
            </div>
            {% endfor %}
          </div>
        </section>
        {% endif %}
        
        <!-- Comments Section -->
        <section class="extension-comments">
          <h2>Feedback & Discussion</h2>
          <script src="https://giscus.app/client.js"
            data-repo="danielshue/vault-copilot-extensions"
            data-repo-id="R_kgDORJfKUQ"
            data-category="Extension Feedback"
            data-category-id="DIC_kwDORJfKUc4C18J5"
            data-mapping="pathname"
            data-strict="0"
            data-reactions-enabled="1"
            data-emit-metadata="0"
            data-input-position="bottom"
            data-theme="preferred_color_scheme"
            data-lang="en"
            crossorigin="anonymous"
            async>
          </script>
        </section>
      </article>
      
      <!-- Sidebar Column -->
      <aside class="extension-sidebar">
        {% include metadata-sidebar.html %}
      </aside>
    </div>
  </main>
  
  {% include footer.html %}
  
  <script>
    // Sidebar toggle functionality
    (function() {
      const toggle = document.querySelector('.sidebar-toggle');
      const sidebar = document.querySelector('.extension-sidebar');
      const closeBtn = document.querySelector('.sidebar-close');
      const backdrop = document.querySelector('.sidebar-backdrop');
      
      function closeSidebar() {
        sidebar.classList.remove('sidebar-open');
        backdrop.classList.remove('backdrop-visible');
        toggle.setAttribute('aria-expanded', 'false');
      }
      
      function openSidebar() {
        sidebar.classList.add('sidebar-open');
        backdrop.classList.add('backdrop-visible');
        toggle.setAttribute('aria-expanded', 'true');
      }
      
      if (toggle && sidebar) {
        // Toggle button click
        toggle.addEventListener('click', function() {
          const isExpanded = this.getAttribute('aria-expanded') === 'true';
          if (isExpanded) {
            closeSidebar();
          } else {
            openSidebar();
          }
        });
        
        // Close button click
        if (closeBtn) {
          closeBtn.addEventListener('click', closeSidebar);
        }
        
        // Backdrop click
        if (backdrop) {
          backdrop.addEventListener('click', closeSidebar);
        }
        
        // Close sidebar when clicking outside on mobile
        document.addEventListener('click', function(e) {
          if (window.innerWidth <= 900) {
            if (!sidebar.contains(e.target) && !toggle.contains(e.target) && sidebar.classList.contains('sidebar-open')) {
              closeSidebar();
            }
          }
        });
      }
    })();
  </script>
</body>
</html>
